<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>Vora - 离场登记</title>
	<!-- Favicon icon -->
	<link rel="icon" type="static/image/png" sizes="16x16" href="static/images/favicon.png">
	<link href="static/vendor/jqvmap/css/jqvmap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="static/vendor/chartist/css/chartist.min.css">
	<!-- Vectormap -->
	<link href="static/vendor/jqvmap/css/jqvmap.min.css" rel="stylesheet">
	<!-- <link href="./vendor/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet"> -->

	<link href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/twitter-bootstrap/4.5.3/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
	<link href="static/css/style.css" rel="stylesheet">
	<link href="static/vendor/owl-carousel/owl.carousel.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Roboto:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
	

	<style>
		.modal-body{
			height: 700px;overflow-y: auto;
		}
		/*  .input-group input,
		 .input-group-prepend,
		 button.btn.dropdown-toggle.btn-light.bs-placeholder
		 {
			height: 30px;
		} */
		/* .input-group-prepend{
			height: 30px;
		}
		button.btn.dropdown-toggle.btn-light.bs-placeholder
		{
			height: 30px;
		} */
	</style>
</head>
<body>


	<!--*******************
		Preloader start
	********************-->
	<div id="preloader">
		<div class="sk-three-bounce">
			<div class="sk-child sk-bounce1"></div>
			<div class="sk-child sk-bounce2"></div>
			<div class="sk-child sk-bounce3"></div>
		</div>
	</div>
	<!--*******************
		Preloader end
	********************-->
	<!--**********************************
		Main wrapper start
	***********************************-->
	<div id="main-wrapper">

		
		<!--**********************************
			Header end ti-comment-alt
		***********************************-->
		<!--**********************************
			Sidebar start
		***********************************-->
		<div class="dlabnav">
			<div class="dlabnav-scroll">
				<ul class="metismenu" id="menu">
					<li>
						<a class="has-arrow ai-icon" href="javascript:void()" aria-expanded="false">
							<i class="flaticon-381-networking"></i>
							<span class="nav-text">审批流程</span>
						</a>
						<ul aria-expanded="false">
							<li><a href="fieldPersonnelList">入场人员登记</a></li>
							<li><a href="LeaveCheckList">请假登记</a></li>
							<li><a href="OffSiteCheckList" class="mm-active">离场登记</a></li>

						</ul>
					</li>
			
				</ul>
				
				<div class="copyright">
					
				</div>
			</div>
		</div>
		<!--**********************************
			Sidebar end
		***********************************-->
		<!--**********************************
			Content body start
		***********************************-->
		<div class="content-body">
			<!-- row -->
			<div class="container-fluid">
				<!-- Add Order -->
				<div class="modal fade" id="addOrderModalside">
					<div class="modal-dialog" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title">Create Project</h5>
								<button type="button" class="close" data-dismiss="modal">
									<span>&times;</span>
								</button>
							</div>
							<div class="modal-body">
								<form>
									<div class="form-group">
										<label class="text-black font-w500">Project Name</label>
										<input type="text" class="form-control">
									</div>
									<div class="form-group">
										<label class="text-black font-w500">Deadline</label>
										<input type="date" class="form-control">
									</div>
									<div class="form-group">
										<label class="text-black font-w500">Client Name</label>
										<input type="text" class="form-control">
									</div>
									<div class="form-group">
										<button type="button" class="btn btn-primary">CREATE</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div id="main_container" class="todoapp">
						<div id="clientToolbar">
							<div class="form-inline ">
								<button title="导出excel" class="btn btn-warning" data-toggle="modal" onclick="ExportExcel()" >
									<span>导出excel</span>
								</button>
								<button title="添加" class="btn btn-warning" data-toggle="modal" style="display:none" id="oc" @click.native="openClients()" data-target="#clientModalCenter">
									<span>添加</span>
								</button>
								<!-- Button trigger modal -->
								<!--	<button type="button" class="btn btn-primary mb-2" data-toggle="modal" data-target="#exampleModalCenter">Modal centered</button>-->
								<!-- Modal -->
								<div class="modal fade bs-example-modal-lg" id="clientModalCenter">
									<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
										<div class="modal-content ">
											<div class="modal-header">
												<h5 class="modal-title">入场登记编辑</h5>
												<button type="button" class="close" data-dismiss="modal">
													<span>&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="card">
													<!--<div class="card-header">

													</div>-->
											<div class="card-body">
														<div class="basic-form">
															<form id="formAdd">

																<div class="input-group mb-3 input-warning">
																	<div class="input-group-prepend">
																		<span class="input-group-text">姓名</span>
																	</div>
																	<input type="text" class="form-control" name="name" id="name" v-model="clientDto.name">
																	<input type="text" class="form-control" style="display:none" name="id" id="id" v-model="clientDto.name">
																</div>
																

																<div class="input-group mb-3 input-danger">
																	<div class="input-group-prepend">
																		<span class="input-group-text">手机号</span>
																	</div>
																	<input type="text"   class="form-control" name="phone" id="phone" v-model="clientDto.phone" >


																</div>
															
																					<div class="input-group mb-3  input-success">
																	<div class="input-group-prepend">
																		<span class="input-group-text">开始时间</span>
																	</div>
																	<input type="text" class="form-control" placeholder="2021-07-14" id="start_time" name="start_time" >

																</div>
																



															</form>
															
														</div>
											</div>
	
											</div>
												</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-danger light" data-dismiss="modal">Close</button>
												<button type="button" class="btn btn-primary" onclick="saveClients()">Save changes</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<table class="table table-striped" id="client_table">
						</table>



					</div>
				</div>
			</div>
		</div>
		<!--**********************************
			Content body end
		***********************************-->
		<!--**********************************
			Footer start
		***********************************-->
		<div class="footer">
			<div class="copyright">
				<p>Copyright © Designed &amp; Developed by  2020</p>
			</div>
		</div>
		<!--**********************************
			Footer end
		***********************************-->
		<!--**********************************
		   Support ticket button start
		***********************************-->
		<!--**********************************
		   Support ticket button end
		***********************************-->
<div id="page-content" style="display:none">
<table>
        <tbody>
		</tboody>
      
    </table>
</div>

	</div>
	

<!-- Required vendors -->

		<script src="https://www.jq22.com/jquery/jquery-3.3.1.js"></script>
	<script src="static/vendor/global/global.min.js"></script>

	<script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/Chart.js/2.8.0/Chart.min.js" type="application/javascript"></script>
	<script src="static/js/custom.min.js"></script>
	<script src="static/js/dlabnav-init.js"></script>
	<script src="static/vendor/owl-carousel/owl.carousel.js"></script>


	<!-- Chart piety plugin files -->
	<script src="static/vendor/peity/jquery.peity.min.js"></script>
		
	<!-- Apex Chart -->
	<script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/apexcharts/3.20.0/apexcharts.min.js"></script>
	<script src="static/js/showTip.js"></script>

	<!-- Dashboard 1 -->
	<!--<script src="/lib/jquery/dist/jquery.min.js"></script>-->

	<script src="static/lib/bootstrap/dist/js/bootstrap.js"></script>


	<link href="static/BootstrapTabs_files/font-awesome.min.css" rel="stylesheet" />

	<script src="static/lib/bootstrap/dist/js/bootstrap-table.min.js"></script>
	<script src="static/lib/bootstrap/dist/js/bootstrap-table-zh-CN.js"></script>
	<link href="static/lib/bootstrap/dist/css/bootstrap-table.min.css" rel="stylesheet" />
	<script src="static/js/axios.min.js"></script>
	<script src="static/js/vue.min.js"></script>
	<!-- <script src="./vendor/bootstrap-select/dist/js/bootstrap-select.min.js"></script> -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://unpkg.com/multiple-select@1.5.2/dist/multiple-select.min.css">
	<link rel="stylesheet" href="static/css/style2csstoggle.css">
		<!-- Material color picker -->
    <link href="static/vendor/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet">
	  <!-- momment js is must -->
    <script src="static/vendor/moment/moment.min.js"></script>
    <script src="static/vendor/bootstrap-daterangepicker/daterangepicker.js"></script>
  <!-- Material color picker -->
    <script src="static/vendor/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
	    <script src="static/vendor/pickadate/picker.js"></script>
    <script src="static/vendor/pickadate/picker.time.js"></script>
    <script src="static/vendor/pickadate/picker.date.js"></script>
		    <!-- Material color picker init -->
    <script src="static/js/plugins-init/material-date-picker-init.js"></script>
<script src="static/js/xlsx.core.min.js"></script>
<script src="static/js/xlsx.full.min.js"></script>
<script src="static/js/FileSaver.js"></script>
<script src="static/js/jquery.wordexport.js"></script>
	<script src="static/js/fileinput.js"></script>
	<link href="static/css/fileinput.css" rel="stylesheet" />
<style>
table {
	    border-collapse: collapse;
	}
	th, td {
	    border: solid 1px #6D6D6D;
	    padding: 5px 10px;
	}
	.mt-sm {margin-top: 8px;}
</style>


  <script type="text/javascript">

	// 将一个sheet转成最终的excel文件的blob对象，然后利用URL.createObjectURL下载
function sheet2blob(sheet, sheetName) {
	sheetName = sheetName || 'sheet1';
	var workbook = {
		SheetNames: [sheetName],
		Sheets: {}
	};
	workbook.Sheets[sheetName] = sheet;
	// 生成excel的配置项
	var wopts = {
		bookType: 'xlsx', // 要生成的文件类型
		bookSST: false, // 是否生成Shared String Table，官方解释是，如果开启生成速度会下降，但在低版本IOS设备上有更好的兼容性
		type: 'binary'
	};
	var wbout = XLSX.write(workbook, wopts);
	var blob = new Blob([s2ab(wbout)], {type:"application/octet-stream"});
	// 字符串转ArrayBuffer
	function s2ab(s) {
		var buf = new ArrayBuffer(s.length);
		var view = new Uint8Array(buf);
		for (var i=0; i!=s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
		return buf;
	}
	return blob;
}
	/**
	 * 通用的打开下载对话框方法，没有测试过具体兼容性
	 * @param url 下载地址，也可以是一个blob对象，必选
	 * @param saveName 保存文件名，可选
	 */
	function openDownloadDialog(url, saveName)
	{
		if(typeof url == 'object' && url instanceof Blob)
		{
			url = URL.createObjectURL(url); // 创建blob地址
		}
		var aLink = document.createElement('a');
		aLink.href = url;
		aLink.download = saveName || ''; // HTML5新增的属性，指定保存文件名，可以不要后缀，注意，file:///模式下不会生效
		var event;
		if(window.MouseEvent) event = new MouseEvent('click');
		else
		{
			event = document.createEvent('MouseEvents');
			event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
		}
		aLink.dispatchEvent(event);
	}

	
	
	


		
		let tableIndex;
		let ExportExcel=function(){
		const client_table=$('#client_table').bootstrapTable('getSelections');//	$('#client_table').bootstrapTable('getData');
		if	(client_table.length==0)
			{Swal.fire("取消", "未选中任何行", "fail");return;}

		const headArr=['姓名','手机号码','开始时间']

		var sheet = XLSX.utils.aoa_to_sheet([headArr].concat(client_table.map(x=> [x.name,x.phone,x.start_time.replace('T00:00:00Z','')])));
		openDownloadDialog(sheet2blob(sheet), '导出.xlsx');

		
		}
		// mount
let saveClients=function () {
					let _this = {};
				_this.phone =$('#phone').val();
					_this.company =$('#company').val();
					_this.name =$('#name').val();
					_this.start_time =$('#start_time').val();
					_this.end_time =$('#end_time').val();
					_this.created_time=timeUtil.getFullTime();


					  

       // fd.append("filename", $('#input-b1')[0].files[0]);
       // fd.append("imgUrl", '/files/'+$('#input-b1')[0].files[0].name);
        $.ajax({
            url: `/OffSiteCheck/${parseInt( $('#id').val())}/`,
            type: 'put',
            processData: false,
            contentType: false,
            data:JSON.stringify( _this),
            success: function () {
				
            		$('[data-dismiss="modal"]').last().click()	
            ShowMsg("提交成功");
			Swal.fire("成功", "提交成功", "success");
				//重新加载数据
$('#client_table').bootstrapTable('refresh');
            	//window.reload();
            }
        })



				}
	let	openClients=function (v) {
			tableIndex = v; $('#oc').click();
					$('#preloader').fadeIn(500);
					let _this = {};
					$.getJSON('/OffSiteCheck/'+v,function(d){
						formDataLoad('formAdd',d.data)
						$('#preloader').fadeOut(500);

					});

				}
		function removeClients(v) {
			Swal.fire({
				type: 'warning', // 弹框类型
				title: '确定 ?', //标题
				text: "审核通过吗 !!", //显示内容

				confirmButtonColor: '#3085d6',// 确定按钮的 颜色
				confirmButtonText: '确定',// 确定按钮的 文字
				showCancelButton: true, // 是否显示取消按钮
				cancelButtonColor: '#d33', // 取消按钮的 颜色
				cancelButtonText: "取消", // 取消按钮的 文字

				focusCancel: true, // 是否聚焦 取消按钮
				reverseButtons: true  // 是否 反转 两个按钮的位置 默认是  左边 确定  右边 取消
			}).then((isConfirm) => {
				try {
					//判断 是否 点击的 确定按钮
					if (isConfirm.value) {
						let _this = {};
					//_this.id =parseInt( $('#id').val());
					//_this.imgUrl ='/files/'+ $('#input-b1')[0].files[0].name;
				
					_this.isCheck=1;

					  

       // fd.append("filename", $('#input-b1')[0].files[0]);
       // fd.append("imgUrl", '/files/'+$('#input-b1')[0].files[0].name);
        $.ajax({
            url: `/OffSiteCheck/${parseInt( v)}/`,
            type: 'put',
            processData: false,
            contentType: false,
            data:JSON.stringify( _this),
            success: function () {
				
          Swal.fire("成功", "审核成功", "success");
				//重新加载数据
$('#client_table').bootstrapTable('refresh');
            	//window.reload();
            }
        })
						
					}
					else {
						//Swal.fire("取消", "点击了取消", "error");
					}
				} catch (e) {
					alert(e);
				}
			});

		}
		(function () {
           

			let config = {

				renderTable: function () {

					$('#client_table').bootstrapTable({

						method: 'get',                      //请求方式（*）
						url: 'OffSiteCheck/',         //请求后台的URL（*） ?page=2&page_size=1
						toolbar: '#clientToolbar',                //工具按钮用哪个容器
						striped: true,                      //是否显示行间隔色
						cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
						pagination: true,                   //是否显示分页（*）
						sortable: false,                     //是否启用排序
						sortOrder: "asc",                   //排序方式
						queryParams: function (params) {   //请求服务器数据时，添加额外参数
							return {
								page_size: params.limit, // 每页要显示的数据条数
								page: (params.offset / params.limit) + 1,    // 页码
								searchText: params.search, SortOrder: params.order,
								SortName: params.sort,
								filter: { clientIdOrname: ("") }

							}
						},//传递参数（*）
						sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
						pageNumber: 1,                       //初始化加载第一页，默认第一页
						pageSize: 10,                       //每页的记录行数（*）
						pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
						search: true,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
						strictSearch: true,
						showColumns: true,                  //是否显示所有的列
						showRefresh: true,                  //是否显示刷新按钮
						minimumCountColumns: 2,             //最少允许的列数
						clickToSelect: true,                //是否启用点击选中行
						height: $(window).height() - 200,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
						uniqueId: "ID",                     //每一行的唯一标识，一般为主键列
						showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
						cardView: false,                    //是否显示详细视图
						detailView: false,                   //是否显示父子表
						onLoadSuccess: function (data) {
							//app.$mount('.todoapp');

						},
						columns: [{
							checkbox: true
						}, {
							field: '',
							title: '序号',
							sortable: true,
							align: "center",
							width: 40,
							formatter: function (value, row, index) {
								return index + 1;
							}
						},
						{
							field: 'name',  //返回json中的name
							title: '姓名',   //表格表头显示文字
							halign: 'center',width: 140,
							align:'center',   //左右居中
							valign: 'middle'
						},

						
						
						{
							field: 'phone',  //返回json中的name
							title: '手机号',   //表格表头显示文字
							halign: 'center',
							width: 240,
							align:'center',   //左右居中
							valign: 'middle' // 上下居中
						},

	
						{
							field: 'start_time',  //返回json中的name
							title: '开始时间',   //表格表头显示文字
							halign: 'center',
							align:'center',   //左右居中
							valign: 'middle' ,
							formatter: function (value) {
								return value.replace('T00:00:00Z','');
							}
						},
						
						{
							field: 'isCheck',  //返回json中的name
							title: '审核状态',   //表格表头显示文字
							halign: 'center',
							align:'center',   //左右居中
							valign: 'middle', // 上下居中
							formatter: function (value) {
								return value ? '<i class="fa fa-circle text-success mr-1"></i>' : '<i class="fa fa-circle text-danger mr-1"></i>';
							}

						},
						{width: 140,
							field: 'id',  //返回json中的name
							title: 'operate',   //表格表头显示文字 <a href="#" class="btn btn-danger shadow btn-xs sharp" onclick="removeClients(${value})"><i class="fa fa-trash"></i></a>
							halign: 'center',
							formatter: function (value) {
								//<!--							return `  <a href="/ClientsManager/CreateOrEdit?id=${value}" title="Edit" class="btn btn-warning">
								//						<span class="fa fa-pencil">Edit</span>
								//					</a><a href="/ClientsManager/Delete2Client?id=${value}" onclick="" title="Delete" class="btn btn-danger">
								//						<span class="fa fa-remove">Dele</span>
								//					</a>`;-->
								/*data - toggle="modal" data - target="#clientModalCenter" @click.native="openClients(${value})"*/
								return `<div class="d-flex">
								<a href="#" class="btn btn-primary shadow btn-xs sharp mr-1" title="编辑" onclick="openClients(${value})"><i class="fa fa-pencil"></i></a><a href="#" class="btn btn-warning shadow btn-xs sharp mr-1" title="审核"  onclick="removeClients(${value})"><i class="fa fa-check"></i></a></div>`;

							},
							align:'center',   //左右居中
							valign: 'middle' // 上下居中
						},

						]
					});
				},
				
				init: () => {

					var self = this;
					config.renderTable();
				
				}
			}
			return config.init()
		})();

	</script>
</body>
</html>

